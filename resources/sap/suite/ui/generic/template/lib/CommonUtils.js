sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/comp/smarttable/SmartTable","sap/ui/table/Table","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/lib/testableHelper"],function(q,B,D,J,S,U,R,L,M,N,a,t){"use strict";function g(p,e){for(var i in p){var E=p[i];if(E.entitySet===e&&E.component.list&&E.navigationProperty){return E.navigationProperty;}else if(E.pages){var r=g(E.pages,e);if(r){return r;}}}}function b(c,s,C){var n;function A(i){s.oApplication.attachControlToParent(i,c.getView());}function d(i,j,e1,f1){return s.oApplication.getDialogFragmentForView(c.getView(),i,j,e1,f1);}var r;function e(){r=r||c.getOwnerComponent().getModel("i18n").getResourceBundle();return r.getText.apply(r,arguments);}function f(){var i=s.oDraftController.getDraftContext();return i.isDraftEnabled(c.getOwnerComponent().getEntitySet());}function h(j){var e1=[];if(j instanceof S){j=j.getTable();}else if(j instanceof sap.ui.comp.smartchart.SmartChart){j=j.getChart();if(j&&j.getMetadata().getName()==="sap.chart.Chart"){var f1=j.getSelectedDataPoints();if(f1.count>0){var g1=f1.dataPoints;for(var i=0;i<g1.length;i++){e1.push(g1[i].context);}}}}if(j instanceof L){e1=j.getSelectedContexts();}else if(j instanceof U){var h1=j.getSelectedIndices();for(var i=0;i<h1.length;i++){e1.push(j.getContextByIndex(h1[i]));}}return e1;}function k(j){var e1,f1,g1,h1,i1,j1;var k1=this.getOwnerControl(j);var l1=k1.getMetadata().getName();if(l1!=="sap.ui.comp.smarttable.SmartTable"&&l1!=="sap.ui.comp.smartchart.SmartChart"){k1=k1.getParent();l1=k1.getMetadata().getName();}var m1=this.getSelectedContexts(k1);var n1=k1.getModel();var o1=n1.getMetaModel();var p1=c.getView();if(l1==="sap.ui.comp.smarttable.SmartTable"){e1=k1.getCustomToolbar()&&k1.getCustomToolbar().getContent();f1=this.getBreakoutActionsForTable(k1);this.fillEnabledMapForBreakoutActions(f1,m1,n1);}else if(l1==="sap.ui.comp.smartchart.SmartChart"){e1=k1.getToolbar()&&k1.getToolbar().getContent();}if(e1&&e1.length>0){for(var i=0;i<e1.length;i++){i1=undefined;g1=e1[i];if(g1.getMetadata().getName()==="sap.m.Button"&&g1.getVisible()){j1=this.getElementCustomData(g1);if(j1&&j1.Type){h1=p1.getLocalId(g1.getId());if(j1.Type==="CRUDActionDelete"){i1=p(n1,o1,m1,k1);}else if(j1.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||j1.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){i1=o(n1,o1,m1,j1.Type,j1.Action);}}if(/generic\/controlProperties/.test(g1.getBindingPath("enabled"))&&i1!==undefined){m(h1,"enabled",i1);}}}}}function l(i,c){var j=this.getBreakoutActionsForFooter(c);var e1=this.getSelectedContexts(i);var f1=i.getModel();this.fillEnabledMapForBreakoutActions(j,e1,f1);}function m(i,j,e1){var f1=c.getView().getModel("_templPriv");var g1=f1.getProperty("/generic/controlProperties/"+i);if(!g1){g1={};g1[j]=e1;f1.setProperty("/generic/controlProperties/"+i,g1);}else{f1.setProperty("/generic/controlProperties/"+i+"/"+j,e1);}}function o(i,e1,f1,g1,h1){var i1,j1,k1,l1;var m1=false;if(g1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){i1=e1.getODataFunctionImport(h1);k1=i1&&i1["sap:action-for"];if(k1&&k1!==""&&k1!==" "){if(f1.length>0){l1=i1["sap:applicable-path"];if(l1&&l1!==""&&l1!==" "){for(var j=0;j<f1.length;j++){j1=i.getObject(f1[j].getPath());if(j1&&j1[l1]===true){m1=true;break;}}}else{m1=true;}}}else{m1=true;}}else if(g1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&f1.length>0){m1=true;}return m1;}function p(j,e1,f1,g1){var h1=G(g1);var i1=false;var j1=e1.getODataEntitySet(g1.getEntitySet());if(sap.suite.ui.generic.template.js.AnnotationHelper.areDeleteRestrictionsValid(e1,j1.entityType,h1)){if(f1.length>0){var k1=h1&&h1.Deletable&&h1.Deletable.Path;if(k1){for(var i=0;i<f1.length;i++){if(j.getProperty(k1,f1[i])){i1=true;break;}}}else{i1=true;}}}return i1;}function G(i){var j=i.getModel()&&i.getModel().getMetaModel();var e1=j&&j.getODataEntitySet(i.getEntitySet());var f1=e1&&e1["Org.OData.Capabilities.V1.DeleteRestrictions"];return f1;}function u(i,j,e1){var f1=y(e1);var g1=c.getView().getModel("_templPriv");var h1=g1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(f1){v(h1,f1,i,j,e1);}g1.setProperty("/generic/listCommons/breakoutActionsEnabled",h1);}function v(i,j,e1,f1,g1){var h1;for(var i1 in j){if(q.inArray(j[i1].id,e1)!==-1){h1=true;if(j[i1].requiresSelection){if(f1.length>0){if(j[i1].applicablePath!==undefined&&j[i1].applicablePath!==""){h1=false;for(var j1=0;j1<f1.length;j1++){var k1="";var l1=j[i1].applicablePath.split("/");if(l1.length>1){for(var m1=0;m1<l1.length-1;m1++){k1+="/"+l1[m1];}}var n1=g1.getObject(f1[j1].getPath()+k1);var o1=l1[l1.length-1];if(n1[o1]===true){h1=true;break;}}}}else{h1=false;}}i[j[i1].id]={enabled:h1};}}}function w(i){var j=[];var e1=q.grep(i.getCustomToolbar().getContent(),function(h1){return h1.getMetadata().getName()==="sap.m.Button";});for(var f1=0;f1<e1.length;f1++){var g1=e1[f1].getId().split("--");j.push(g1[g1.length-1]);}return j;}function x(c){var i=[];var j=[];var e1=c.getView().byId("page");if(e1&&e1.getFooter()){j=q.grep(e1.getFooter().getContent(),function(h1){return h1.getMetadata().getName()==="sap.m.Button";});}for(var f1=0;f1<j.length;f1++){var g1=j[f1].getId().split("--");i.push(g1[g1.length-1]);}return i;}function y(i){var j=c.getOwnerComponent().getAppComponent().getManifestEntry("sap.ui5");var e1=j.extends&&j.extends.extensions&&j.extends.extensions["sap.ui.controllerExtensions"];if(e1){var f1=(e1[c.getOwnerComponent().getTemplateName()]||{})["sap.ui.generic.app"]||{};var g1=i.getMetaModel();var h1=(f1[g1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Actions"];if(!h1){h1={};var i1=(f1[g1.getODataEntitySet(c.getOwnerComponent().getEntitySet()).name]||{})["Sections"];if(i1){for(var j1 in i1){h1=q.extend(h1,i1[j1]["Actions"]);}}}return h1;}}function z(i){var j=i;while(j){if(j instanceof R||j instanceof U||j instanceof S||j instanceof sap.ui.comp.smartchart.SmartChart){return j;}if(j.getParent){j=j.getParent();}else{return null;}}return null;}function E(i){if(i instanceof S){i=i.getTable();}if(i instanceof U){return i.getBindingInfo("rows");}else if(i instanceof R){return i.getBindingInfo("items");}return null;}function F(i){var j=E(i);if(j&&j.binding){j.binding.refresh();}else{i.rebindTable();}}function H(i,j){var e1=i.getPath();var f1=c.getOwnerComponent();var g1="";if(f1.getComponentContainer().getElementBinding()){g1=f1.getComponentContainer().getElementBinding().getPath();}var h1=null;if(e1.indexOf(g1)!==0){h1=E(j).path;}var i1=!s.oApplication.isNewHistoryEntryRequired(i,h1);var j1;if(f()){j1=s.oDraftController.isActiveEntity(i)?1:6;}else{j1=c.getOwnerComponent().getModel("ui").getProperty("/editable")?6:1;}s.oNavigationController.navigateToContext(i,h1,i1,j1);}function I(i,j){var e1;if(j&&j.navigationProperty){e1=j.navigationProperty;}s.oNavigationController.navigateToContext(i,e1,false);}function K(i){if(i instanceof a){M.show(i.getErrorCode(),{title:e("ST_GENERIC_ERROR_TITLE")});}}function O(i,j){X(function(){n=c1();var e1={semanticObject:i.semanticObject,action:i.action};var f1=n.mixAttributesAndSelectionVariant(i.parameters);c.adaptNavigationParameterExtension(f1,e1);n.navigate(i.semanticObject,i.action,f1.toJSONString(),j.getCurrentAppState&&j.getCurrentAppState()||{},K);},q.noop,j,"LeavePage");}function P(i,j,c){var e1={semanticObject:i.semanticObject,action:""};n=c1();var f1=n.mixAttributesAndSelectionVariant(i.semanticAttributes,j);c.adaptNavigationParameterExtension(f1,e1);var g1=f1.toJSONString();delete i.semanticAttributes;n.processBeforeSmartLinkPopoverOpens(i,g1);}function Q(i,j,e1){if(!i){return e("DRAFT_OBJECT");}else if(j){return e(e1?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function T(){var i=d("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var j=Array.prototype.slice.call(arguments,1);var e1=arguments[0];if(!e1){return"";}if(j.length>0&&(j[0]===null||j[0]===undefined||j[0]==="")){if(j.length>3&&(j[3]===null||j[3]===undefined||j[3]==="")){return(j.length>2&&(j[1]===null||j[1]===undefined||j[1]===""))?"":j[2];}else{return e(e1,j[3]);}}else{return e(e1,j[0]);}},closeDraftAdminPopover:function(){i.close();},formatDraftLockText:Q},"admin");return i;}function V(i,j,e1,f1,g1){var h1=s.oApplication.getBusyHelper();if(!g1&&h1.isBusy()){return;}if(!f()){var i1=false;if(e1&&e1.aUnsavedDataCheckFunctions){i1=e1.aUnsavedDataCheckFunctions.some(function(k1){return k1();});}if(i1||c.getView().getModel().hasPendingChanges()){var j1;Z(function(){c.getView().getModel().resetChanges();C.fire(c,"AfterCancel",{});j1=i();},function(){j1=j();},f1);return j1;}}return i();}function W(i,j,e1,f1){var g1=false;if(e1&&e1.aUnsavedDataCheckFunctions){g1=e1.aUnsavedDataCheckFunctions.some(function(i1){return i1();});}if(g1||c.getView().getModel().hasPendingChanges()){var h1;_(function(){c.getView().getModel().resetChanges();C.fire(c,"AfterCancel",{});h1=i();},function(){h1=j();},f1);return h1;}return i();}function X(i,j,e1,f1,g1){if(g1){return V(i,j,e1,f1,true);}s.oApplication.performAfterSideEffectExecution(V.bind(null,i,j,e1,f1,false));}var Y;function Z(i,j,e1){Y=i;if(!e1){e1="LeavePage";}var f1=d("sap.suite.ui.generic.template.fragments.DataLoss",{onDataLossOK:function(){f1.close();Y();},onDataLossCancel:function(){f1.close();j();}},"dataLoss");var g1=f1.getModel("dataLoss");g1.setProperty("/mode",e1);f1.open();}var $;function _(i,j,e1){$=i;if(!e1){e1="LeavePage";}var f1=d("sap.suite.ui.generic.template.fragments.DataLossTechnicalError",{onDataLossOK:function(){f1.close();$();},onDataLossCancel:function(){f1.close();j();}},"dataLoss");var g1=f1.getModel("dataLoss");g1.setProperty("/mode",e1);f1.open();}function a1(i,j,e1,f1,g1,h1){if(j.busy.check&&f1.isBusy()){h1();return;}var i1=(j.dataloss.popup?X(i,h1,e1,(j.dataloss.navigation?"LeavePage":"Proceed"),true):i());if(i1 instanceof Promise){i1.then(g1,h1);}else{g1();}}function b1(i,j,e1){j=q.extend(true,{busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},j);var f1=s.oApplication.getBusyHelper();var g1=new Promise(function(h1,i1){s.oApplication.performAfterSideEffectExecution(a1.bind(null,i,j,e1,f1,h1,i1));});if(j.busy.set){f1.setBusy(g1);}return g1;}function c1(){n=n||new N(c);return n;}function d1(j,e1){var f1,g1,h1,i1,j1,k1=[],l1=[],i,m1,n1,o1,p1,q1,r1;var s1,t1;f1=c.getOwnerComponent().getAppComponent();g1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");h1=e1.getProperty("/generic/supportedIntents/");i1=j.getCustomToolbar().getContent();j1=i1.length;for(i=0;i<j1;i++){m1=this.getElementCustomData(i1[i]);if(m1.hasOwnProperty("SemanticObject")&&m1.hasOwnProperty("Action")){n1=m1.SemanticObject;o1=m1.Action;p1={semanticObject:n1,action:o1,ui5Component:f1};k1.push([p1]);q1=q.extend({},p1);q1.bLinkIsSupported=false;l1.push(q1);}}if(k1.length>0&&!!g1){r1=g1.getLinks(k1);r1.done(function(u1){h1=e1.getProperty("/generic/supportedIntents/");s1=u1.length;for(i=0;i<s1;i++){if(u1[i][0].length>0){l1[i].bLinkIsSupported=true;}n1=l1[i].semanticObject;o1=l1[i].action;t1=e1.getProperty("/generic/supportedIntents/"+n1);if(!t1){h1[n1]={};h1[n1][o1]={"visible":l1[i].bLinkIsSupported};}else if(!t1[o1]){t1[o1]={"visible":l1[i].bLinkIsSupported};}else{t1[o1]["visible"]=l1[i].bLinkIsSupported;}}});}}var c1=t.testable(c1,"getNavigationHandler");var f=t.testable(f,"isDraftEnabled");return{getNavigationProperty:g,getText:e,isDraftEnabled:f,getNavigationHandler:c1,executeGlobalSideEffect:function(){if(f()){var i=c.getView();i.attachBrowserEvent("keyup",function(j){if(j.keyCode===13&&i.getModel("ui").getProperty("/editable")){var e1=c.getOwnerComponent().getAppComponent().getManifestEntry("sap.ui.generic.app");var f1=e1.settings&&e1.settings.forceGlobalRefresh;s.oApplicationController.executeSideEffects(i.getBindingContext(),null,null,f1);}});}},setEnabledToolbarButtons:k,setEnabledFooterButtons:l,fillEnabledMapForBreakoutActions:u,getBreakoutActionsForTable:w,getBreakoutActionsForFooter:x,getBreakoutActionsFromManifest:y,getSelectedContexts:h,getDeleteRestrictions:G,setPrivateModelControlProperty:m,navigateFromListItem:H,navigateToContext:I,navigateExternal:O,semanticObjectLinkNavigation:P,getCustomData:function(j){var e1=j.getSource().getCustomData();var f1={};for(var i=0;i<e1.length;i++){f1[e1[i].getKey()]=e1[i].getValue();}return f1;},formatDraftLockText:Q,showDraftPopover:function(i,j){var e1=T();var f1=e1.getModel("admin");f1.setProperty("/IsActiveEntity",i.getProperty("IsActiveEntity"));f1.setProperty("/HasDraftEntity",i.getProperty("HasDraftEntity"));e1.bindElement({path:i.getPath()+"/DraftAdministrativeData"});if(e1.getBindingContext()){e1.openBy(j);}else{e1.getObjectBinding().attachDataReceived(function(){e1.openBy(j);});}},getContentDensityClass:function(){return s.oApplication.getContentDensityClass();},attachControlToView:A,getDialogFragment:d,processDataLossConfirmationIfNonDraft:X,processDataLossTechnicalErrorConfirmation:W,securedExecution:b1,getOwnerControl:z,getTableBindingInfo:E,refreshSmartTable:F,getElementCustomData:function(i){var j={};if(i instanceof sap.ui.core.Element){i.getCustomData().forEach(function(e1){j[e1.getKey()]=e1.getValue();});}return j;},triggerAction:function(i,j,e1,f1,g1){X(function(){s.oCRUDManager.callAction({functionImportPath:e1.Action,contexts:i,sourceControl:f1,label:e1.Label,operationGrouping:"",navigationProperty:""}).then(function(h1){if(h1&&h1.length>0){var i1=h1[0];if(i1.response&&i1.response.context&&(!i1.actionContext||i1.actionContext&&i1.response.context.getPath()!==i1.actionContext.getPath())){s.oViewDependencyHelper.setMeToDirty(c.getOwnerComponent(),j);}}});},q.noop,g1,"Proceed");},checkToolbarIntentsSupported:d1};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(c,s,C){q.extend(this,b(c,s,C));}});});
