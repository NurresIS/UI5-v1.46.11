// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";var c="sap.ushell_abap.adapters.abap.LaunchPageAdapter",d="/UI2/Fiori2LaunchpadHome",D="/UI2/FLPD_CATALOG",s="X-SAP-UI2-CHIP:/UI2/DYNAMIC_APPLAUNCHER",S="X-SAP-UI2-CHIP:/UI2/STATIC_APPLAUNCHER";jQuery.sap.declare("sap.ushell_abap.adapters.abap.LaunchPageAdapter");sap.ushell_abap.adapters.abap.LaunchPageAdapter=function(u,p,a){var C,o=null,P=false,g,G,t=new sap.ui2.srvc.Map(),A=(a&&a.config)||{},T=A.services&&A.services.targetMappings,l=A.services&&A.services.launchPage,E={},b=this;if(!T){throw new Error("Configuration for target mappings service not passed");}if(!T.baseUrl){throw new Error("baseUrl was not passed in Configuration for target mappings service");}if(!T.relativeUrl){throw new Error("relativeUrl was not passed in Configuration for target mappings service");}function f(e,i,M){try{return e.getImplementationAsSapui5();}catch(n){jQuery.sap.log.error(M+": "+(n.message||n),n.stack,c);return new sap.ushell.ui.tile.StaticTile({icon:"sap-icon://error",info:"",infoState:"Critical",subtitle:n.message||n,title:i}).addStyleClass("sapUshellTileError");}}sap.ui2.srvc.testPublishAt(b);function h(e,i,n){if(e.getBagIds().indexOf(i)>-1&&e.getBag(i).getTextNames().indexOf(n)>-1){return e.getBag(i).getText(n);}}sap.ui2.srvc.testPublishAt(b);function j(e,i,n){if(e.getBagIds().indexOf(i)>-1&&e.getBag(i).getPropertyNames().indexOf(n)>-1){return e.getBag(i).getProperty(n);}}sap.ui2.srvc.testPublishAt(b);function k(i,n,x){var M,N;try{M=i.getConfigurationParameter(n);N=JSON.parse(M);}catch(e){return;}if(N[x]!==undefined){return N[x];}}sap.ui2.srvc.testPublishAt(b);function m(e,x){var O=e&&sap.ui2.srvc.isArray(e.order)?e.order:[],M={},N=[],Q,R,i,n;O=e&&sap.ui2.srvc.isArray(e.order)?e.order:[];O=O.concat(e&&sap.ui2.srvc.isArray(e.linkOrder)?e.linkOrder:[]);for(i=0,n=x.length;i<n;i+=1){Q=x[i];M[Q.getId()]=Q;}for(i=0,n=O.length;i<n;i+=1){R=O[i];if(Object.prototype.hasOwnProperty.call(M,R)){N.push(M[R]);delete M[R];}}for(i=0,n=x.length;i<n;i+=1){Q=x[i];if(Object.prototype.hasOwnProperty.call(M,Q.getId())){N.push(Q);}}return N;}function q(){var i;try{i=JSON.parse(o.getConfiguration());i.order.splice(0,0,o.getDefaultPage().getId());}catch(e){i={order:[o.getDefaultPage().getId()]};}return m(i,o.getPages());}this.hideGroups=function(e){var i,n=new jQuery.Deferred();if(!e||!(e instanceof Array)){n.reject('Input parameter must be of type Array.');}else{i=JSON.parse(o.getConfiguration()||"{}");i.hiddenGroups=e;o.setConfiguration(JSON.stringify(i),n.resolve.bind(n),n.reject.bind(n));}return n.promise();};this.isGroupVisible=function(e){var n=o.getConfiguration(),x,M,i;if(!n){return true;}x=JSON.parse(n);if(!x||!x.hiddenGroups){return true;}M=x.hiddenGroups;for(i=0;i<M.length;i+=1){if(M[i]===e.getId()){return false;}}return true;};sap.ui2.srvc.testPublishAt(b);function r(e){function i(){e.hasOwnProperty("_loadingDeferred")&&e._loadingDeferred.resolve();delete e._loadingDeferred;delete e.$loadingPromise;}function n(M){jQuery.sap.log.error("Failed to load tile: "+M,e.toString(),c);e.hasOwnProperty("_loadingDeferred")&&e._loadingDeferred.reject();delete e._loadingDeferred;delete e.$loadingPromise;}e.load(i,n);}function v(e,i){var n=0,x=[],R=[],M,N,O=[];function Q(){if(n<=0){i();}}function U(W,X){W._loadingDeferred=new jQuery.Deferred();W.$loadingPromise=W._loadingDeferred.promise();if(window["sap-ui-debug"]){r(W);}else if(X){if(M){M.then(function(){r(W);});}else{if(!N){N=jQuery.sap._loadJSResourceAsync("sap/fiori/indicator-tiles.js");O.push(N);}Promise.race(O).then(function(){r(W);}).catch(function(){jQuery.sap.log.error("Failed to load sap/fiori/indicator-tiles.js");});}}else{if(!M){M=jQuery.sap._loadJSResourceAsync("sap/fiori/core-ext-light.js");O.push(M);}M.then(function(){r(W);}).catch(function(){jQuery.sap.log.error("Failed to load sap/fiori/core-ext-light.js");});}}function V(W){function X(){n-=1;Q();}n+=1;W.load(X,function(Y){jQuery.sap.log.error("Failed to load tile: "+Y,W.toString(),c);X();});}e.forEach(function(W){W.getChipInstances().forEach(function(X){if(H(X)){V(X);}else if(I(X)){R.push(X);}else{x.push(X);}});});x.forEach(function(W){var X=false,Y;try{Y=W.getChip().getBaseChipId();["X-SAP-UI2-CHIP:SSB_","X-SAP-UI2-CHIP:/SSB/"].forEach(function($){if(Y.indexOf($)>-1){X=true;}});}catch(Z){}U(W,X);});R.forEach(function(W){var X=false,Y;try{Y=W.getChip().getRemoteCatalog().getCatalogData().baseUrl;["/sap/hba/r/sb/core/odata/modeler/SMART_BUSINESS.xsodata/","/sap/hba/r/sb/core/odata/runtime/SMART_BUSINESS.xsodata/"].forEach(function($){if(Y.indexOf($)>-1){X=true;}});}catch(Z){}U(W,X);});Q();}sap.ui2.srvc.testPublishAt(b,"readTargetMappings");function w(){var e=new jQuery.Deferred(),i,n,U;function M(N){var R=[];Object.keys(N).forEach(function(O){var x={};["semanticObject","semanticAction","formFactors"].forEach(function(Q){x[Q]=N[O][Q];});R.push(x);});return R;}if(jQuery.sap.getObject("compactTMPromise",undefined,A)){A.compactTMPromise.then(function(R){var x=M(R||{});e.resolve({results:x});},function(x){e.reject(x);});return e.promise();}i=jQuery.sap.getObject("services.targetMappings",0,A);n=i.cacheId||"";U="/sap/bc/ui2/start_up?so=*&action=*&tm-compact=true&shellType="+b._getShellType()+"&depth=0";if(n){U+=(U.indexOf("?")<0?"?":"&")+"sap-cache-id="+n;}sap.ui2.srvc.get(U,false,function(x){var N=JSON.parse(x),O=N.targetMappings||{};var R=M(O);e.resolve({results:R});},function(x){e.reject(x);});return e.promise();}sap.ui2.srvc.testPublishAt(b);function y(e,i){return t.get(e+"-"+i);}sap.ui2.srvc.testPublishAt(b);function z(e){return!e.getConfiguration();}function B(e){var i=[],n=sap.ushell.Container.getService("PageBuilding").getFactory();e.forEach(function(x){var R=x.getRemoteCatalog(),M;if(x.getBaseChipId()==="X-SAP-UI2-CHIP:/UI2/ACTION"){return;}M=n.createChipInstance({chipId:x.getId(),remoteCatalogId:R&&R.getId()});i.push(M);});return i;}function F(){var e=o.getDefaultPage().getAllCatalogs(),n,x=e.getCatalogs(),W=[],i;for(i=0;i<x.length;i+=1){n=x[i];W.push({data:{},errorMessage:undefined,id:n.getId(),title:n.isStub()?n.getId():n.getTitle(),tiles:n.isStub()?[]:B(n.getChips()),ui2catalog:n});}return W;}function H(e){var i=e.getChip().getBaseChipId();return i===s||i===S;}function I(e){if(e.getChip().getRemoteCatalog()){return true;}return false;}function J(e){var i,n=e.getConfigurationParameter("tileConfiguration");;try{i=JSON.parse(n||"{}");}catch(x){jQuery.sap.log.error("Tile with ID '"+e.getId()+"' has a corrupt configuration containing a 'tileConfiguration' value '"+n+"' which could not be parsed. If present, a (stringified) JSON is expected as value.",x.message,"sap.ushell_abap.adapters.abap.LaunchPageAdapter");return{};}return i;}this.getGroups=function(){var e,M,U;if(P){return(new jQuery.Deferred()).resolve(q()).promise();}if(!g){g=new jQuery.Deferred();e=new jQuery.Deferred();U=sap.ushell.Container.getService("PageBuilding");if(l&&l.cacheId){U.getFactory().getPageBuildingService().readPageSet.cacheBusterTokens.put(d,l.cacheId);}U.getPageSet(d).fail(e.reject.bind(e)).done(function(i){o=i;o.filter([d],[D]);v(i.getPages(),e.resolve.bind(e));});M=w().done(function(i){var n=sap.ui2.srvc.getFormFactor();i.results.forEach(function(x){var N=x.semanticObject+"-"+x.semanticAction;t.put(N,t.get(N)||!!(x.formFactors&&x.formFactors[n]));});});jQuery.when(M,e).done(function(){P=true;g.resolve(q());}).fail(g.reject.bind(g));}return g.promise();};this.getDefaultGroup=function(){var e=new jQuery.Deferred();this.getGroups().done(function(){e.resolve(o.getDefaultPage());}).fail(e.reject.bind(e));return e.promise();};this.getGroupTitle=function(e){return e.getTitle();};this.getGroupId=function(e){return e.getId();};this.getGroupTiles=function(i){var n;try{n=JSON.parse(i.getLayout());}catch(e){jQuery.sap.log.warning("Group "+i.getId()+": invalid layout: "+i.getLayout(),null,c);}return m(n,i.getChipInstances());};this.addGroup=function(e){var i=new jQuery.Deferred();o.appendPage(e,D,i.resolve.bind(i),i.reject.bind(i,q()));return i.promise();};this.removeGroup=function(e){var i=new jQuery.Deferred();if(o.isPageRemovable(e)){o.removePage(e,i.resolve.bind(i),i.reject.bind(i,q()));}else{i.reject(q());}return i.promise();};this.resetGroup=function(e){var i=new jQuery.Deferred();if(o.isPageRemovable(e)){i.reject(q());}else if(o.isPageResettable(e)){o.resetPage(e,function(){v([e],i.resolve.bind(i,e));},i.reject.bind(i,q()));}else{i.resolve();}return i.promise();};this.isGroupRemovable=function(e){return o.isPageRemovable(e);};this.isGroupLocked=function(e){return e.isPersonalizationLocked();};this.isTileIntentSupported=function(e){var i,n,x,M,N;if(!H(e)){return true;}if(e.isStub()){throw new sap.ui2.srvc.Error("Applauncher Tile not loaded completely","sap.ushell_abap.adapters.abap.LaunchPageAdapter");}i=J(e);if(e.getChip()&&typeof e.getChip().isBrokenReference==="function"&&e.getChip().isBrokenReference()){return false;}if(jQuery.isEmptyObject(i)){return false;}if(!i.navigation_use_semantic_object){return true;}n=y(i.navigation_semantic_object,i.navigation_semantic_action)||false;if(!n){x=h(e,"tileProperties","display_title_text")||i.display_title_text;M=h(e,"tileProperties","display_subtitle_text")||i.display_subtitle_text;N=i.navigation_target_url;jQuery.sap.log.warning("Group tile with ID '"+e.getId()+"' is filtered out as the current user has no target mapping assigned for the intent '"+N+"'","\nGroup Tile ID: '"+e.getId()+"'\n"+"Title: '"+x+"'\n"+"Subtitle: '"+M+"'\n"+"Intent: '"+N+"' - ","sap.ushell_abap.adapters.abap.LaunchPageAdapter");}return n;};this.moveGroup=function(e,n){var i=new jQuery.Deferred();function x(M){var N,O=[];M.forEach(function(Q){O.push(Q.getId());});N=JSON.parse(o.getConfiguration()||"{}");N.order=O;o.setConfiguration(JSON.stringify(N),i.resolve.bind(i),i.reject.bind(i,q()));}this.getGroups().done(function(M){var N=M.indexOf(e);M.splice(N,1);M.splice(n,0,e);x(M);});return i.promise();};this.setGroupTitle=function(e,n){var i=new jQuery.Deferred();e.setTitle(n,i.resolve.bind(i),function(){i.reject(e.getTitle());});return i.promise();};this.addTile=function(e,i){var n=new jQuery.Deferred(),x=e.getChip();if(e.isStub()){n.reject(q(),"Tile was not added to the group as the tile failed loading");}else{if(!i){i=o.getDefaultPage();}i.addChipInstance(x,n.resolve.bind(n),n.reject.bind(n,q()));}return n.promise();};this.removeTile=function(e,i){var n=jQuery.Deferred();e.removeChipInstance(i,n.resolve.bind(n),n.reject.bind(n,q()));return n.promise();};this.moveTile=function(n,x,M,N,O){var Q=new jQuery.Deferred(),R=z(n),U,V=new sap.ui2.srvc.Map(),W,X,Y,Z,$=Q.reject.bind(Q,q()),_=2;function a1(c1,d1,e1){var i,f1;try{f1=JSON.parse(c1.getLayout());}catch(e){f1={};}f1.order=[];for(i=0;i<d1.length;i+=1){f1.order.push(d1[i].getId());}c1.setLayout(JSON.stringify(f1),e1,$);}function b1(e){_-=1;W=W||e;if(_<=0){Q.resolve(W);}}if(!O){O=N;}Y=this.getGroupTiles(N);x=Y.indexOf(n);if(x<0){jQuery.sap.log.error("moveTile: tile not found in source group",null,c);$();return Q.promise();}Y.splice(x,1);if(N===O){Y.splice(M,0,n);a1(N,Y,Q.resolve.bind(Q,n),$);}else{U=sap.ushell.Container.getService("PageBuilding").getFactory().getPageBuildingService();X=n.getBagIds();X.forEach(function(e){var i={texts:[],properties:[]},c1=n.getBag(e);c1.getOwnTextNames().forEach(function(d1){i.texts.push({name:d1,value:c1.getText(d1)});});c1.getOwnPropertyNames().forEach(function(d1){i.properties.push({name:d1,value:c1.getProperty(d1)});});if(i.texts.length>0||i.properties.length>0){V.put(e,i);}});U.openBatchQueue();Z=this.getGroupTiles(O);O.addChipInstance(R?n.getChip():n,function(e){var i,c1;Z.splice(M,0,e);X.forEach(function(d1){c1=V.get(d1);if(c1){i=e.getBag(d1);c1.texts.forEach(function(e1){i.setText(e1.name,e1.value);});c1.properties.forEach(function(e1){i.setProperty(e1.name,e1.value);});i.save(function(){},function(){jQuery.sap.log.error("Bag "+d1+": could not be saved",null,c);});}});a1(O,Z,b1.bind(this,e));},$,n.isStub());N.removeChipInstance(n,b1,$);a1(N,Y,undefined);U.submitBatchQueue(undefined,$);}return Q.promise();};this.getTileId=function(e){return e.getId();};this.getTileType=function(i){var n=i.getPage(),x;try{x=JSON.parse(n.getLayout());if(x.linkOrder&&x.linkOrder.indexOf(i.getId())>-1){return"link";}}catch(e){jQuery.sap.log.warning("Group "+n.getId()+": invalid layout: "+n.getLayout(),null,c);}return"tile";};this.getTileTitle=function(e){return e.getTitle();};this.getTileView=function(e){var b=this,i=new jQuery.Deferred(),n;function x(){n=e.getContract("types");if(n){n.setType(b.getTileType(e));}i.resolve(e.getImplementationAsSapui5());}function M(N){i.reject("Tile not successfully loaded"+(N?(": "+N):""));}if(!e.$loadingPromise){if(!e.isStub()){sap.ui2.srvc.call(x,M,!H(e));}else{M();}}else{e.$loadingPromise.fail(M).done(function(){try{x();}catch(N){M((N.message||N));}});}return i.promise();};this.getTileSize=function(e){var i=(!e.isStub()&&e.getConfigurationParameter("row"))||"1",n=(!e.isStub()&&e.getConfigurationParameter("col"))||"1";return i+"x"+n;};this.refreshTile=function(e){e.refresh();};this.setTileVisible=function(e,n){var V=!e.isStub()&&e.getContract("visible"),i,O;if(V){V.setVisible(n);return;}if(e.isStub()&&e.$loadingPromise){i=this.getTileId(e);O=E[i];E[i]=n;if(O===undefined){e.$loadingPromise.done(function(){var V=e.getContract("visible");if(V){V.setVisible(E[i]);}});}return;}};this.getTileActions=function(e){var i=!e.isStub()&&e.getContract("actions");if(i){return i.getActions();}return[];};this.getTileTarget=function(e){return null;};this.getTileDebugInfo=function(e){var i,n,x=e.getChip(),M=x.getCatalog();i={chipId:x.getId(),chipInstanceId:e.getId(),completelyLoaded:!e.isStub()};if(M){i.catalogId=M.getId();}n=JSON.stringify(i);return n;};this.getCatalogs=function(){var e,O=G,R=C===false;function i(){var N=0,W=F();W.forEach(function(Q){var U=Q.ui2catalog;if(U.isStub()||U.getType()==='H'||U.getType()==='REMOTE'){N+=1;U.refresh(function(){Q.title=U.getTitle();Q.tiles=B(U.getChips());e.notify(Q);N-=1;if(N<=0){e.resolve(W);}},function(V){jQuery.sap.log.error("Failed to load catalog: "+V,U.toString(),c);Q.errorMessage=V||"Error";e.notify(Q);N-=1;if(N<=0){e.resolve(W);}});}else{e.notify(Q);e.$notified=true;}});if(N<=0){e.resolve(W);}}function n(){var W=F();W.forEach(function(N){e.notify(N);});e.resolve(W);}function x(N){var Q=o.getDefaultPage().getAllCatalogs();if(Q.isStub()){Q.load(i,e.reject.bind(e),"type eq 'CATALOG_PAGE' or type eq 'H' or type eq 'SM_CATALOG'"+" or type eq 'REMOTE'",true,"title");}else{sap.ui2.srvc.call(R?i:n,e.reject.bind(e),N);}}function M(N){if(T&&T.cacheId){sap.ushell.Container.getService("PageBuilding").getFactory().getPageBuildingService().readAllCatalogs.cacheBusterTokens.put(d,T.cacheId);}if(P){x(N);}else{b.getGroups().done(x).fail(e.reject.bind(e));}}if(G&&!G.$notified&&!R){e=G;}else{e=G=new jQuery.Deferred();e.done(function(){if(e===G){C=true;}}).always(function(){if(e===G){G=null;}});if(O){if(R){C=undefined;}O.always(M);}else{M(true);}}return e.promise();};this.isCatalogsValid=function(){return!!C;};this.getCatalogData=function(e){return e.ui2catalog.getCatalogData();};this.getCatalogError=function(e){return e.errorMessage;};this.getCatalogId=function(e){return e.id;};this.getCatalogTitle=function(e){return e.title;};this.getCatalogTiles=function(e){var i,n,x=new jQuery.Deferred(),M=0;function N(){M-=1;if(M===0){x.resolve(e.tiles);}}function O(Q,R){jQuery.sap.log.error("Failed to load catalog tile: "+R,Q.toString(),c);N();}for(i=0;i<e.tiles.length;i+=1){n=e.tiles[i];if(n.isStub()){M+=1;n.load(N,O.bind(null,n));}}if(M===0){x.resolve(e.tiles);}return x.promise();};this.getCatalogTileId=function(e){var i=e.getChip(),n=i.getId();if(i.getCatalog()&&i.getCatalog().getCatalogData()&&i.getCatalog().getCatalogData().systemAlias){n+="_"+i.getCatalog().getCatalogData().systemAlias;}return n;};this.getCatalogTileTitle=function(e){return e.getChip().getTitle();};this.getCatalogTileSize=function(e){return this.getTileSize(e);};this.getCatalogTileView=function(e){var i=this.getCatalogTileTitle(e);if(e.isStub()){jQuery.sap.log.warning("CHIP (instance) is just a stub!",e.toString(true),c);return new sap.ushell.ui.tile.StaticTile({icon:"sap-icon://hide",info:"",infoState:"Critical",subtitle:"",title:i}).addStyleClass("sapUshellTileError");}if(e.getContract("preview")){e.getContract("preview").setEnabled(true);return f(e,i,"Cannot get catalog tile view as SAPUI5");}return new sap.ushell.ui.tile.StaticTile({title:i,subtitle:"",info:"",infoState:"Neutral",icon:"sap-icon://folder-full"});};this.getCatalogTileTargetURL=function(e){var i=k(e,"tileConfiguration","navigation_target_url");return i||(!e.isStub()&&e.getContract("preview")&&e.getContract("preview").getTargetUrl())||undefined;};this.getCatalogTilePreviewSubtitle=function(e){var i=h(e,"tileProperties","display_subtitle_text");return i||(!e.isStub()&&e.getContract("preview")&&e.getContract("preview").getPreviewSubtitle())||undefined;};this.getCatalogTilePreviewTitle=function(e){var i=h(e,"tileProperties","display_title_text");return i||(!e.isStub()&&e.getContract("preview")&&e.getContract("preview").getPreviewTitle())||undefined;};this.getCatalogTilePreviewIcon=function(e){var i=k(e,"tileConfiguration","display_icon_url");return i||(!e.isStub()&&e.getContract("preview")&&e.getContract("preview").getPreviewIcon())||undefined;};this.getCatalogTileKeywords=function(e){var i;function n(x){if(x){i.push(x);}}if(!e.isStub()&&e.getContract("search")){i=e.getContract("search").getKeywords();}else{i=[];}n(e.getTitle());n(e.getChip().getDescription());return i;};this.addBookmark=function(i,n){var x=S,M={display_icon_url:i.icon||"",display_info_text:i.info||"",display_subtitle_text:i.subtitle||"",display_title_text:i.title,navigation_target_url:i.url,navigation_use_semantic_object:false},N=new jQuery.Deferred(),O=sap.ushell.Container.getService("PageBuilding").getFactory(),U,Q=new URI(),R,V,W=O.getPageBuildingService(),X;function Y(X,M,N){X.getBag("tileProperties").setText("display_title_text",M.display_title_text||"");X.getBag("tileProperties").setText("display_subtitle_text",M.display_subtitle_text||"");X.getBag("tileProperties").setText("display_info_text",M.display_info_text||"");X.getBag("tileProperties").save(function(){N.resolve();},function(Z){N.reject(Z);});}R=new URI(i.url);if(i.url&&(i.url[0]==='#'||R.host()+R.path()===Q.host()+Q.path())){U=sap.ushell.Container.getService("URLParsing");V=U.parseShellHash(U.getShellHash(i.url));if(V&&y(V.semanticObject,V.action)!==undefined){M.navigation_use_semantic_object=true;M.navigation_semantic_object=V.semanticObject;M.navigation_semantic_action=V.action;M.navigation_semantic_parameters=U.paramsToString(V.params);}}if(i.serviceUrl){x=s;M.display_number_unit=i.numberUnit;M.service_refresh_interval=i.serviceRefreshInterval||0;M.service_url=i.serviceUrl;}if(n&&!(n instanceof sap.ui2.srvc.Page)){N.reject("The given object is not a group");return N.promise();}if(P){n=n||o.getDefaultPage();X=O.createChipInstance({chipId:x,pageId:n.getId(),title:i.title,configuration:JSON.stringify({tileConfiguration:JSON.stringify(M)}),layoutData:""});n.addChipInstance(X,function(Z){Y(Z,M,N);},N.reject.bind(N),undefined);}else{try{W.createPageChipInstanceFromRawData({chipId:x,configuration:JSON.stringify({tileConfiguration:JSON.stringify(M)}),pageId:"/UI2/Fiori2LaunchpadHome",title:i.title},function(Z){O.createChipInstance(Z,function($){Y($,M,N);},N.reject.bind(N),undefined);},N.reject.bind(N));}catch(e){N.reject(e.toString());}}return N.promise();};sap.ui2.srvc.testPublishAt(b);function K(e,U){return H(e)&&J(e).navigation_target_url===U;}sap.ui2.srvc.testPublishAt(b);function L(U,V){var e=[],i=new jQuery.Deferred();b.getGroups().fail(i.reject.bind(i)).done(function(n){var x=0;n.forEach(function(M){M.getChipInstances().forEach(function(N){if(K(N,U)){x+=1;if(V){e.push(V(N));}}});});if(e.length===0){i.resolve(x);}else{jQuery.when.apply(jQuery,e).fail(function(M){i.reject(M);}).done(function(){i.resolve(x);});}});return i.promise();}this.countBookmarks=function(U){return L(U);};this.deleteBookmarks=function(U){return L(U,function(e){var i=new jQuery.Deferred();e.remove(i.resolve.bind(i),i.reject.bind(i));return i.promise();});};this.updateBookmarks=function(U,e){return L(U,function(i){var n=J(i),x=new jQuery.Deferred(),M=false;function N(){i.getContract("configuration").fireConfigurationUpdated(["tileConfiguration"]);Q();}function O(){i.getContract("bag").fireBagsUpdated(["tileProperties"]);x.resolve();}function Q(){if(typeof n.display_title_text==="string"){i.getBag("tileProperties").setText("display_title_text",n.display_title_text);M=true;}if(typeof n.display_subtitle_text==="string"){i.getBag("tileProperties").setText("display_subtitle_text",n.display_subtitle_text);M=true;}if(typeof n.display_info_text==="string"){i.getBag("tileProperties").setText("display_info_text",n.display_info_text);M=true;}if(M){i.getBag("tileProperties").save(O,x.reject.bind(x));}else{x.resolve();}}n.display_icon_url=e.icon||n.display_icon_url;n.display_info_text=e.info||n.display_info_text;n.display_subtitle_text=e.subtitle||n.display_subtitle_text;n.display_title_text=e.title||n.display_title_text;n.navigation_target_url=e.url||n.navigation_target_url;n.display_number_unit=e.numberUnit||n.display_number_unit;n.service_refresh_interval=e.serviceRefreshInterval||n.service_refresh_interval;n.service_url=e.serviceUrl||n.service_url;i.updateConfiguration({tileConfiguration:JSON.stringify(n)},N,x.reject.bind(x));return x.promise();});};this.onCatalogTileAdded=function(e){C=false;};};sap.ushell_abap.adapters.abap.LaunchPageAdapter.prototype._getShellType=function(){if(sap&&sap.ushell_abap&&typeof sap.ushell_abap.getShellType==="function"){return sap.ushell_abap.getShellType();}return"FLP";};}());
