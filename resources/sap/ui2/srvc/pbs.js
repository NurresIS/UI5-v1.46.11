// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
this.sap=this.sap||{};(function(){"use strict";sap.ui2=sap.ui2||{};sap.ui2.srvc=sap.ui2.srvc||{};function n(){}var r=n;if(typeof jQuery==="function"&&jQuery.sap){jQuery.sap.declare("sap.ui2.srvc.pbs");r=function(){jQuery.sap.require.apply(this,arguments);};}sap.ui2.srvc.testPublishAt=sap.ui2.srvc.testPublishAt||function(){};var c;if(!sap.ui2.srvc.Map){r("sap.ui2.srvc.utils");}c=new sap.ui2.srvc.Map();sap.ui2.srvc.ODataService=function(o,d){var B;this.getCsrfToken=function(){if(c.get(B)&&c.get(B).token){return c.get(B).token;}return"";};this.getDefaultErrorHandler=function(){return d;};this.openBatchQueue=function(){o.openBatchQueue();};this.refreshCsrfToken=function(s,f){var t;if(typeof s!=="function"){throw new sap.ui2.srvc.Error("Success callback is not a function","sap.ui2.srvc.ODataService");}f=f||d;t=c.get(B);if(!t.fetchingInProgress){t.token=undefined;t.fetchingInProgress=true;o.read("",function(){if(!c.get(B)||!c.get(B).token){f("No CSRF token delivered");t.errorHandlers.forEach(function(h){h("No CSRF token delivered");});}else{s();t.successHandlers.forEach(function(h){h();});}t.successHandlers=[];t.errorHandlers=[];t.fetchingInProgress=false;},f);}else{t.successHandlers.push(s);t.errorHandlers.push(f);}};this.setCsrfToken=function(N){var t;if(N&&typeof N!=="string"){throw new sap.ui2.srvc.Error("Invalid CSRF token: "+N,"sap.ui2.srvc.ODataService");}t=c.get(B);t.token=N;};this.setDefaultErrorHandler=function(N){if(N&&typeof N!=="function"){throw new sap.ui2.srvc.Error("Error callback is not a function","sap.ui2.srvc.ODataService");}d=N||n;};this.submitBatchQueue=function(){o.submitBatchQueue.apply(o,arguments);};this.toString=function(v){var R=['sap.ui2.srvc.ODataService({'];if(v){R.push('csrfToken:"',this.getCsrfToken(),'"');R.push(',oODataWrapper:',o.toString(true));}R.push('})');return R.join('');};if(!sap.ui2.srvc.Error){r("sap.ui2.srvc.error");}if(!o){throw new sap.ui2.srvc.Error("Missing OData wrapper","sap.ui2.srvc.ODataService");}B=o.getBaseUrl();if(!c.get(B)){c.put(B,{fetchingInProgress:false,successHandlers:[],errorHandlers:[]});}this.setDefaultErrorHandler(d);};if(typeof OData!=="object"){r("sap.ui.thirdparty.datajs");}function a(d,R){if(sap.ui2.srvc.isArray(d)){d.forEach(function(D){D.reject(R);});}else{d.reject(R);}}sap.ui2.srvc.ODataWrapper=function(B,o,s){var S="saplb",d,C,D,R,t=this;sap.ui2.srvc.testPublishAt(t);function g(){return d;}sap.ui2.srvc.testPublishAt(t);function h(K,H){var i;K=K.toLowerCase();for(i in H){if(Object.prototype.hasOwnProperty.call(H,i)&&i.toLowerCase()===K){return H[i];}}return undefined;}function e(H){var i=sap.ui2.srvc.ODataWrapper["sap-language"],j=sap.ui2.srvc.ODataWrapper["sap-statistics"],w=sap.ui2.srvc.ODataWrapper["sap-client"];H=H||{};if(i){H["sap-language"]=i;}if(j||(j==="false")){H["sap-statistics"]=""+j;}if(w){H["sap-client"]=w;}return H;}function f(H){H=H||{};var i=sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B];if(typeof i==="undefined"){return H;}if(i&&i.enabled&&typeof i.value!=="undefined"){H[S]=i.value;}return H;}sap.ui2.srvc.testPublishAt(t);function k(i){var H,j=sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B];if(!j||!j.enabled){return;}H=h(S,i);if(typeof H==="undefined"){return;}if(j.value!==H){j.value=H;}}sap.ui2.srvc.testPublishAt(t);function l(H){return h("x-csrf-token",H)||"";}sap.ui2.srvc.testPublishAt(t);function m(i,M,P,j,F,H){var w;j=j||n;F=F||o.getDefaultErrorHandler();t.check(j,F);w={'Accept':"application/json",'Accept-Language':(sap.ui&&sap.ui.getCore().getConfiguration().getLanguage())||"",'X-CSRF-Token':o.getCsrfToken()};e(w);f(w);OData.request({requestUri:i,method:M,data:P,headers:w},function(x,y){k((y||{}).headers);jQuery.sap.log.debug("Received OData response for "+M+' "'+i+'"',null,"sap.ui2.srvc.ODataWrapper");sap.ui2.srvc.call(j.bind(null,x),F);},function(E){function x(){R=false;F.apply(null,arguments);}function y(){R=false;j.apply(null,arguments);}if(!R&&E.response.statusCode===403&&l(E.response.headers).toLowerCase()==="required"){jQuery.sap.log.debug("CSRF token required for "+M+' "'+i+'", refreshing it',JSON.stringify(E.response),"sap.ui2.srvc.ODataWrapper");R=true;o.refreshCsrfToken(m.bind(t,i,M,P,y,x,H),x);}else{t.onError(M,i,F,null,E);}},H);jQuery.sap.log.debug("Sent OData request for "+M+' "'+i+'"',null,"sap.ui2.srvc.ODataWrapper");}sap.ui2.srvc.testPublishAt(t);function p(j){var i=j.indexOf(B);if(i<0){throw new sap.ui2.srvc.Error('Not relative to base URL "'+B+'": '+j,"sap.ui2.srvc.ODataWrapper");}return j.slice(i+B.length);}sap.ui2.srvc.testPublishAt(t);function q(i){if(/^\//.test(i)){throw new sap.ui2.srvc.Error("Not a relative URL: "+i,"sap.ui2.srvc.ODataWrapper");}return B+i;}sap.ui2.srvc.testPublishAt(t);function u(i,j,w){var x,y=q(i),H=f(e());if(d){jQuery.sap.log.debug('Queued OData request for GET "'+i+'"',null,"sap.ui2.srvc.ODataWrapper");d.push({method:"GET",requestUri:i,headers:H});x=(new jQuery.Deferred()).done(j).fail(w);D.push(x);C=false;return;}H["Accept"]="application/json";H["Accept-Language"]=(sap.ui&&sap.ui.getCore().getConfiguration().getLanguage())||"";H["X-CSRF-Token"]="Fetch";OData.read({requestUri:y,headers:H},j,w);jQuery.sap.log.debug('Sent OData request for GET "'+y+'"',null,"sap.ui2.srvc.ODataWrapper");}sap.ui2.srvc.testPublishAt(t);function v(i,M,P,j,F){var w,x={data:P,method:M,requestUri:i,headers:f(e())},y=q(i);if(d){j=j||n;F=F||o.getDefaultErrorHandler();t.check(j,F);jQuery.sap.log.debug("Queued OData request for "+M+' "'+i+'"',null,"sap.ui2.srvc.ODataWrapper");if(!C){d.push({__changeRequests:[]});D.push([]);C=s;}d[d.length-1].__changeRequests.push(x);w=(new jQuery.Deferred()).done(function(z,A){jQuery.sap.log.debug("Received OData response for "+M+' "'+y+'"',null,"sap.ui2.srvc.ODataWrapper");sap.ui2.srvc.call(j.bind(null,z),F);}).fail(t.onError.bind(t,M,y,F,null));D[D.length-1].push(w);return;}m(y,M,P,j,F);}this.isStickySessionEnabled=function(){return(sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B]||{}).enabled||false;};this.enableStickySession=function(){sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B].enabled=true;};this.check=function(i,F){if(!i){throw new sap.ui2.srvc.Error("Missing success callback","sap.ui2.srvc.ODataWrapper");}if(typeof i!=="function"){throw new sap.ui2.srvc.Error("Success callback is not a function","sap.ui2.srvc.ODataWrapper");}if(!F){throw new sap.ui2.srvc.Error("Missing error callback","sap.ui2.srvc.ODataWrapper");}if(typeof F!=="function"){throw new sap.ui2.srvc.Error("Error callback is not a function","sap.ui2.srvc.ODataWrapper");}};this.create=function(i,P,j,F){v(i,"POST",P,j,F);};this.del=function(E,i,F){var j=E;if(typeof j!=="string"){j=p(E.__metadata.uri);}v(j,"DELETE",null,function(w){if(i){i();}},F);};this.getBaseUrl=function(){return B;};this.getODataService=function(){return o;};this.onError=function(M,i,F,j,E){var P,w="Error ";if(E.response&&E.response.statusCode){w+="("+E.response.statusCode+", "+E.response.statusText+") ";}w+="in OData response for "+M+' "'+i+'": '+E.message;if(E.response&&E.response.body){try{P=JSON.parse(E.response.body).error;if(P){if(P.hasOwnProperty("message")&&P.message.hasOwnProperty("value")){w+="\nDetails: "+P.message.value;}if(E.response.statusCode&&!P.httpStatus){P.httpStatus=E.response.statusCode;}}}catch(x){}}jQuery.sap.log.error(w,JSON.stringify(E.response),"sap.ui2.srvc.ODataWrapper");if(j){j.reject(w,P);}F(w,P);};this.openBatchQueue=function(){if(d){throw new sap.ui2.srvc.Error("Batch queue already open","sap.ui2.srvc.ODataWrapper");}d=[];D=[];C=false;};this.isBatchQueueOpen=function(){return!!d;};this.read=function(i,j,F,w){var x,y=q(i),z;function A(E,G){k(G.headers);o.setCsrfToken(l(G.headers)||o.getCsrfToken());jQuery.sap.log.debug('Received OData response for GET "'+y+'"',null,"sap.ui2.srvc.ODataWrapper");z=h("sap-message",G.headers);if(z){jQuery.sap.log.warning("SAP message for GET "+y,z,"sap.ui2.srvc.ODataWrapper");}if(x){x.resolve(JSON.parse(JSON.stringify(E)),o.getCsrfToken());}sap.ui2.srvc.call(j.bind(null,E),F);}F=F||o.getDefaultErrorHandler();this.check(j,F);if(w){OData.read.$cache=OData.read.$cache||new sap.ui2.srvc.Map();x=OData.read.$cache.get(y);if(x){jQuery.sap.log.debug('Using cached response for GET "'+y+'"',null,"sap.ui2.srvc.ODataWrapper");x.done(function(E,G){o.setCsrfToken(o.getCsrfToken()||G);sap.ui2.srvc.call(j.bind(null,JSON.parse(JSON.stringify(E))),F);}).fail(F);return;}x=new jQuery.Deferred();OData.read.$cache.put(y,x.promise());}u(i,A,this.onError.bind(this,"GET",y,F,x));};this.batch=function(P,i,F){var j=q("$batch");m(j,"POST",P,i,F,OData.batchHandler);};this.submitBatchQueue=function(w,x){var M=D;function y(z){var A=z.__batchResponses.length,E=M.length;if(E!==A){t.onError("POST",q("$batch"),x,null,{message:"Protocol error! Expected "+E+" responses, but received "+A});return;}z.__batchResponses.forEach(function(F,i){var G=M[i];if(F.response){a(G,F);}else if(F.__changeResponses){F.__changeResponses.forEach(function(H,j){G[j].resolve(H.data,H);});}else{G.resolve(F.data,F);}});if(w){sap.ui2.srvc.call(w,o.getDefaultErrorHandler());}}if(!d){throw new sap.ui2.srvc.Error("No open batch queue to submit","sap.ui2.srvc.ODataWrapper");}if(d.length>0){this.batch({__batchRequests:d},y,x);}else if(w){sap.ui2.srvc.call(w,o.getDefaultErrorHandler(),true);}d=undefined;D=undefined;};this.toString=function(V){var i=['sap.ui2.srvc.ODataWrapper({sBaseUrl:"',B,'"'];i.push('})');return i.join('');};this.put=function(i,P,j,F){v(i,"PUT",P,function(w){if(j){j();}},F);};this.update=function(E,i,F){var P={"__metadata":{type:E.__metadata&&E.__metadata.type}},j,w=p(E.__metadata.uri);for(j in E){if(Object.prototype.hasOwnProperty.call(E,j)&&j.indexOf('$')!==0&&typeof E[j]!=="object"){P[j]=E[j];}}this.put(w,P,i,F);};if(!sap.ui2.srvc.Map){r("sap.ui2.srvc.utils");}if(!B||typeof B!=="string"){throw new sap.ui2.srvc.Error("Missing base URL","sap.ui2.srvc.ODataWrapper");}if(!o||typeof o!=="object"){throw new sap.ui2.srvc.Error("Missing OData service facade","sap.ui2.srvc.ODataWrapper");}B=B.replace(/\/$/,"")+"/";if(typeof sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration==="undefined"){jQuery.sap.log.error("sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration is not defined!","the sap.ui2.srvc.ODataWrapper constructor was called before the static property was defined","sap.ui2.srvc.ODataWrapper");}else if(typeof sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B]==="undefined"){sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration[B]={enabled:false,value:undefined};}};if(typeof sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration==="undefined"){sap.ui2.srvc.ODataWrapper.oStickySessionConfiguration={};}sap.ui2.srvc.testPublishAt(sap.ui2.srvc.ODataWrapper);function b(w){try{sap.ui2.srvc.ODataWrapper["sap-statistics"]=sap.ui.getCore().getConfiguration().getStatistics();}catch(e){sap.ui2.srvc.ODataWrapper["sap-statistics"]=/sap-statistics=(true|x|X)/.test(w);}}b(window.location.search);sap.ui2.srvc.createODataWrapper=function(B,s,d){function S(){var w=new sap.ui2.srvc.ODataWrapper(B,this,s);r("sap.ui2.srvc.ODataService");sap.ui2.srvc.ODataService.call(this,w,d);return w;}return new S();};sap.ui2.srvc.PageBuildingService=function(o,d,I){var w,t=this;function e(s){return s.replace(/\'/g,"''").replace(/&/g,"%26");}function g(p,B,E){var P;if(typeof p==="string"){P=p;}else{if(p.instanceId){return"ChipInstanceBags(pageId='"+encodeURIComponent(p.pageId)+"',instanceId='"+encodeURIComponent(p.instanceId)+"',id='"+encodeURIComponent(B)+"')"+(E?"?$expand=ChipInstanceProperties":"");}P=p.id;}return"Bags(pageId='"+encodeURIComponent(P)+"',id='"+encodeURIComponent(B)+"')"+(E?"?$expand=Properties":"");}sap.ui2.srvc.testPublishAt(t);function f(E){if(E.statusCode==="201"){return E.data;}if(E.statusCode==="204"){return undefined;}return E.message||"";}sap.ui2.srvc.testPublishAt(t);function h(C,G,s,F){var R=[];function j(k){var i,l=[];for(i=0;i<k.length;i+=1){l[i]=f(k[i]);}return l;}s=s||function(){};F=F||t.getDefaultErrorHandler();w.check(s,F);C=C||[];G=G||[];if(C.length>0){R.push({__changeRequests:C});}R=R.concat(G);if(R.length===0){sap.ui2.srvc.call(s.bind(null,[],[]),F,true);return;}w.batch({__batchRequests:R},function(D){var B=D.__batchResponses,i=B[0].__changeResponses;if(B[0].response&&B[0].message){w.onError("POST",w.getBaseUrl()+"$batch",F,undefined,D.__batchResponses[0]);return;}if((i&&(i.length!==C.length))||(B.length!==R.length)){F("Number of requests differs from number of responses in $batch");return;}if(i){sap.ui2.srvc.call(s.bind(null,j(i),j(B.slice(1))),F,false);}else{sap.ui2.srvc.call(s.bind(null,[],j(B)),F,false);}},F);}this.isPersonalization=function(){return!!I;};this.readMetadata=function(s,F,N){var R=w.getBaseUrl()+"$metadata"+(N?"?"+Date.now():"");F=F||this.getDefaultErrorHandler();w.check(s,F);OData.read(R,function(D){sap.ui2.srvc.call(s.bind(null,D),F);},w.onError.bind(w,"GET",R,F,undefined),OData.metadataHandler);};this.deleteBag=function(p,B,s,F){if(!p){throw new sap.ui2.srvc.Error("Missing parent ID or object","sap.ui2.srvc.PageBuildingService");}if(!B){throw new sap.ui2.srvc.Error("Missing bag ID","sap.ui2.srvc.PageBuildingService");}w.del(g(p,B,false),s,F);};this.readBag=function(p,B,s,F){if(!p){throw new sap.ui2.srvc.Error("Missing parent ID or object","sap.ui2.srvc.PageBuildingService");}if(!B){throw new sap.ui2.srvc.Error("Missing bag ID","sap.ui2.srvc.PageBuildingService");}w.read(g(p,B,true),s,F);};this.readAllCatalogs=function(p,s,F,i,S){var j="id";if(S&&typeof S==="string"){j=S;}var u="Pages('"+encodeURIComponent(p)+"')/allCatalogs?$expand=Chips/ChipBags/ChipProperties&"+"$orderby="+j;if(i&&typeof i==="string"){u=u+"&$filter="+encodeURIComponent(i);}if(this.readAllCatalogs.cacheBusterTokens&&this.readAllCatalogs.cacheBusterTokens.get(p)){u+="&sap-cache-id="+this.readAllCatalogs.cacheBusterTokens.get(p);}w.read(u,s,F);};this.readCatalogs=function(s,F,i){var u="Catalogs?$orderby=id";if(i&&typeof i==="string"){u=u+"&$filter="+encodeURIComponent(i);}w.read(u,s,F);};this.readAllCatalogsForUser=function(F,s,i){var u=F?"?$filter="+encodeURIComponent(F):"";w.read("Pages('unused')/allCatalogs"+u,s,i);};this.getReferencingCatalogIds=function(R,s,F){if(typeof s!=="function"){s=F;F=arguments[3];}function i(j){var k=[],l=j.results||[];l.forEach(function(C){if(C.referenceChipId===R){if(k.indexOf(C.catalogId)===-1){k.push(C.catalogId);}}});s(k);}if(typeof R!=="string"){throw new sap.ui2.srvc.Error("sReferencedChipId must be a string","sap.ui2.srvc.test.PageBuildingService");}if(typeof s!=="function"){throw new sap.ui2.srvc.Error("fnSuccess is mandatory","sap.ui2.srvc.test.PageBuildingService");}w.read("Chips?$filter="+encodeURIComponent("referenceChipId eq '"+e(R)+"'"),i,function(m){new sap.ui2.srvc.Error(m,"sap.ui2.srvc.PageBuildingService");F.apply(null,arguments);});};this.createPageBasedCatalog=function(D,T,s,F){if(!D){throw new sap.ui2.srvc.Error("Missing domain ID","sap.ui2.srvc.PageBuildingService");}w.create("Catalogs",{domainId:D,title:T,type:"CATALOG_PAGE"},s,F);};this.createCatalog=function(C,s,F){w.create("Catalogs",C,s,F);};this.deleteCatalog=function(C,s,F){w.del(C,s,F);};this.cloneCatalog=function(C,N,s,S,F){if(!C){throw new sap.ui2.srvc.Error("Missing source catalog ID","sap.ui2.srvc.PageBuildingService");}if(!N){throw new sap.ui2.srvc.Error("Missing new domain ID","sap.ui2.srvc.PageBuildingService");}if(N.indexOf(":")>=0){throw new sap.ui2.srvc.Error("Illegal domain ID: "+N,"sap.ui2.srvc.PageBuildingService");}w.create("CloneCatalog?sourceId='"+encodeURIComponent(C)+"'&targetId='"+encodeURIComponent(N)+(s!==undefined?"'&title='"+encodeURIComponent(s)+"'":"'"),{},S,F);};this.clonePageChipInstance=function(s,S,T,i,F){if(!s){throw new sap.ui2.srvc.Error("Missing source page ID","sap.ui2.srvc.PageBuildingService");}if(!S){throw new sap.ui2.srvc.Error("Missing source CHIP instance ID","sap.ui2.srvc.PageBuildingService");}if(!T){throw new sap.ui2.srvc.Error("Missing target page ID","sap.ui2.srvc.PageBuildingService");}w.create("ClonePageChipInstance?sourcePageId='"+encodeURIComponent(s)+"'&sourceChipInstanceId='"+encodeURIComponent(S)+"'&targetPageId='"+encodeURIComponent(T)+"'",{},function(R){w.read("PageChipInstances(pageId='"+encodeURIComponent(R.pageId)+"',instanceId='"+encodeURIComponent(R.instanceId)+"')"+"?$expand=ChipInstanceBags/ChipInstanceProperties",i,F);},F);};this.readCatalog=function(C,s,F,N,i){var u;if(!C){throw new sap.ui2.srvc.Error("Missing catalog ID","sap.ui2.srvc.PageBuildingService");}u="Catalogs('"+encodeURIComponent(C)+"')";if(!N){u+="?$expand=Chips";if(!i){u+="/ChipBags/ChipProperties";}}w.read(u,s,F);};this.updateCatalog=function(C,s,F){w.update(C,s,F);};this.readCatalogChips=function(C,i,s,F){var u,j="",p="?$filter=";if(!C){throw new sap.ui2.srvc.Error("Missing catalog ID","sap.ui2.srvc.PageBuildingService");}u="Catalogs('"+encodeURIComponent(C)+"')/Chips";if(i){if(!i.length){throw new sap.ui2.srvc.Error("No CHIP IDs given","sap.ui2.srvc.PageBuildingService");}i.forEach(function(k){j=j+p+"id%20eq%20'"+encodeURIComponent(k)+"'";p="%20or%20";});if(w.getBaseUrl().length+u.length+j.length>2000){j="";}}w.read(u+j,s,F);};this.createPage=function(i,C,l,T,s,F){if(!i){throw new sap.ui2.srvc.Error("Missing page ID","sap.ui2.srvc.PageBuildingService");}w.create("Pages",{id:i,catalogId:C,layout:l,title:T},s,F);};this.readPages=function(s,F,N){var u="Pages?";if(!N){u+="$expand=Catalog&";}w.read(u+"$orderby=id",s,F);};this.readPage=function(i,s,F,C){var u="Pages('"+encodeURIComponent(i)+"')";if(!i){throw new sap.ui2.srvc.Error("Missing page ID","sap.ui2.srvc.PageBuildingService");}if(C===undefined){u+="?$expand=Bags/Properties,PageChipInstances/Chip/ChipBags/ChipProperties,"+"PageChipInstances/RemoteCatalog,"+"PageChipInstances/ChipInstanceBags/ChipInstanceProperties";}else if(C!==""){u+="?$expand="+C;}w.read(u,s,F);};this.readPageSet=function(i,s,F){var u;if(!i){throw new sap.ui2.srvc.Error("Missing page set ID","sap.ui2.srvc.PageBuildingService");}u="PageSets('"+encodeURIComponent(i)+"')?$expand="+"Pages/PageChipInstances/Chip/ChipBags/ChipProperties,"+"Pages/PageChipInstances/RemoteCatalog,"+"Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"AssignedPages,"+"DefaultPage";if(this.readPageSet.cacheBusterTokens&&this.readPageSet.cacheBusterTokens.get(i)){u+="&sap-cache-id="+this.readPageSet.cacheBusterTokens.get(i);}w.read(u,s,F,true);};this.updatePageSet=function(p,s,F){w.update(p,s,F);};this.createPageInPageSet=function(p,P,C,s,F){if(!p){throw new sap.ui2.srvc.Error("Missing page set ID","sap.ui2.srvc.PageBuildingService");}w.create("PageSets('"+encodeURIComponent(p)+"')/Pages",{catalogId:C||"",layout:"",title:P||""},s,F);};this.updatePage=function(p,s,F){w.update(p,s,F);};this.deletePage=function(i,s,F){if(!i){throw new sap.ui2.srvc.Error("Missing page ID","sap.ui2.srvc.PageBuildingService");}w.del("Pages('"+encodeURIComponent(i)+"')",s,F);};this.createPageChipInstance=function(p,i,C,T,s,l,S,F){this.createPageChipInstanceFromRawData({pageId:p,instanceId:i,chipId:C,title:T,configuration:s,layoutData:l},S,F);};this.createPageChipInstanceFromRawData=function(C,s,F){if(typeof C!=="object"){throw new sap.ui2.srvc.Error("Invalid raw data","sap.ui2.srvc.PageBuildingService");}if(!C.pageId){throw new sap.ui2.srvc.Error("Missing page ID","sap.ui2.srvc.PageBuildingService");}if(!C.chipId){throw new sap.ui2.srvc.Error("Missing CHIP ID","sap.ui2.srvc.PageBuildingService");}C.instanceId=C.instanceId||"";C.title=C.title||"";C.configuration=C.configuration||"";C.layoutData=C.layoutData||"";w.create("PageChipInstances",C,s,F);};this.updatePageChipInstance=function(C,s,F){w.update(C,s,F);};this.deletePageChipInstance=function(p,i,s,F){if(!p){throw new sap.ui2.srvc.Error("Missing page ID","sap.ui2.srvc.PageBuildingService");}if(!i){throw new sap.ui2.srvc.Error("Missing instance ID","sap.ui2.srvc.PageBuildingService");}w.del("PageChipInstances(pageId='"+encodeURIComponent(p)+"',instanceId='"+encodeURIComponent(i)+"')",s,F);};this.updateBagProperties=function(p,B,C,N,R,s,F){var j=[],G=[],i,k,P,l,m="__metadata";function q(E){var u={"__metadata":{type:E[m].type,uri:E[m].uri}},v;for(v in E){if(Object.prototype.hasOwnProperty.call(E,v)&&v!==m&&v.indexOf('$')!==0&&typeof E[v]!=="object"){u[v]=E[v];}}return u;}if(!p){throw new sap.ui2.srvc.Error("Missing parent object","sap.ui2.srvc.PageBuildingService");}if(!B){throw new sap.ui2.srvc.Error("Missing bag ID","sap.ui2.srvc.PageBuildingService");}if(typeof R==="function"){this.updateBagProperties(p,B,C,N,[],R,s);return;}C=C||[];N=N||[];R=R||[];if(C.length===0&&N.length===0&&R.length===0){throw new sap.ui2.srvc.Error("No properties to update, create or reset","sap.ui2.srvc.PageBuildingService");}for(i=0;i<C.length;i+=1){P=C[i];l=P[m].uri;k=l.indexOf(w.getBaseUrl());if(k>=0){l=l.slice(k+w.getBaseUrl().length);}j.push({requestUri:l,method:"PUT",data:q(P)});}l=p.instanceId?"ChipInstanceProperties":"Properties";for(i=0;i<N.length;i+=1){P=N[i];if(!P.name){throw new sap.ui2.srvc.Error("Missing property name","sap.ui2.srvc.PageBuildingService");}if(p.instanceId){P.instanceId=p.instanceId;P.pageId=p.pageId;}else{P.pageId=p.id;}P.bagId=B;j.push({requestUri:l,method:"POST",data:P});}for(i=0;i<R.length;i+=1){P=R[i];l=P[m].uri;k=l.indexOf(w.getBaseUrl());if(k>=0){l=l.slice(k+w.getBaseUrl().length);}j.push({requestUri:l,method:"DELETE"});G.push({requestUri:l,method:"GET"});}h(j,G,function(u,v){var x=u.slice(N.length+C.length),i;for(i=0;i<x.length;i+=1){if(x[i]===undefined){if(typeof v[i]==="object"){x[i]=v[i];}}}if(s){s(u.slice(0,C.length),u.slice(C.length,N.length+C.length),x);}},F);};this.createProperty=function(p,B,P,v,T,s,F){var i;if(!p){throw new sap.ui2.srvc.Error("Missing parent ID or object","sap.ui2.srvc.PageBuildingService");}if(!B){throw new sap.ui2.srvc.Error("Missing bag ID","sap.ui2.srvc.PageBuildingService");}if(!P){throw new sap.ui2.srvc.Error("Missing property name","sap.ui2.srvc.PageBuildingService");}if(typeof T==="function"){this.createProperty(p,B,P,v,undefined,T,s);return;}i={bagId:B,name:P,pageId:p,translatable:T,value:v};if(typeof p!=="string"){if(p.instanceId){i.instanceId=p.instanceId;i.pageId=p.pageId;}else{i.pageId=p.id;}}w.create((i.instanceId?"ChipInstanceProperties":"Properties"),i,s,F);};this.updateProperty=function(p,s,F){w.update(p,s,F);};this.deleteProperty=function(p,s,F){w.del(p,s,F);};this.readChip=function(C,s,F){if(!C){throw new sap.ui2.srvc.Error("Missing CHIP ID","sap.ui2.srvc.PageBuildingService");}w.read("Chips('"+encodeURIComponent(C)+"')"+"?$expand=ChipBags/ChipProperties",s,F);};if(!sap.ui2.srvc.Error){r("sap.ui2.srvc.error");}if(typeof o==="string"){w=new sap.ui2.srvc.ODataWrapper(o,this,true);}else{w=o;}this.readAllCatalogs.cacheBusterTokens=new sap.ui2.srvc.Map();this.readPageSet.cacheBusterTokens=new sap.ui2.srvc.Map();if(!w.isStickySessionEnabled()&&!I){w.enableStickySession();}sap.ui2.srvc.ODataService.call(this,w,d);};if(!sap.ui2.srvc.createPageBuildingService){sap.ui2.srvc.createPageBuildingService=function(B,d,i){return new sap.ui2.srvc.PageBuildingService(B,d,i);};}}());
