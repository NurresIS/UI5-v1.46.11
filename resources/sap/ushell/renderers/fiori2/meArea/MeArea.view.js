// @copyright@
sap.ui.define(["sap/ushell/services/AppType","sap/m/Button","sap/m/List","sap/m/Text","sap/m/VBox","sap/m/HBox","sap/m/Image","sap/m/Dialog","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ScrollContainer","sap/ushell/resources","sap/ushell/ui/launchpad/UserStatusItem","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/ListSeparators"],function(a,B,L,T,V,H,I,D,P,O,S,r,U,A,b){"use strict";sap.ui.jsview("sap.ushell.renderers.fiori2.meArea.MeArea",{createContent:function(c){this.addStyleClass('sapUshellMeAreaView');this.aDanglingControls=[];var u=sap.ushell.Container.getUser().getFullName(),p,t=sap.ushell.resources.i18n,C=(this.getViewData()?this.getViewData().config:{})||{},s=C.appState,d=(s==='embedded'||s==='embedded-home'||s==='standalone'||s==='blank-home'||s==='blank'),e,o=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.UserStatus");if(o){var f=o.createInstance(),g=function(i){f.then(function(o){o.setStatus(i);p.close();});};}e=[new U({status:U.prototype.STATUS_ENUM.AVAILABLE,id:"userStatusItem1",isOpener:false,press:function(i){g(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AVAILABLE);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.AWAY,id:"userStatusItem2",isOpener:false,press:function(i){g(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.AWAY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.BUSY,id:"userStatusItem3",isOpener:false,press:function(i){g(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.BUSY);}.bind(this)}).addStyleClass('sapUserStatusContainer'),new U({status:U.prototype.STATUS_ENUM.APPEAR_OFFLINE,id:"userStatusItem4",isOpener:false,press:function(i){g(sap.ushell.ui5service.UserStatus.prototype.AvailableStatus.APPEAR_OFFLINE);}.bind(this)}).addStyleClass('sapUserStatusContainer')];if(!C.disableSignOut){e.push(new U({status:U.prototype.STATUS_ENUM.SIGNOUT,id:"userStatusLogout",isOpener:false,press:[c.logout,c]}).addStyleClass('sapUserStatusSignOutContainer'));}var h=new L({id:"sapUshellUserStatusItemList",showSeparators:"None",items:e});h.addCustomData(new A({key:"aria-labelledBy",value:"userStatusItem1",writeToDom:true}));p=new P("statuses",{placement:sap.m.PlacementType.Bottom,showArrow:false,showHeader:false,content:h}).addStyleClass('sapUserStatusPopOver');p.addStyleClass("sapContrastPlus");p.setOffsetX(-3);e=[new T({text:u}).addStyleClass('sapUshellMeAreaUserName')];var j=new sap.ushell.ui.launchpad.UserStatusItem({id:"userStatusOpener",visible:{parts:["/userStatusEnabled","/userStatusUserEnabled"],formatter:function(i,v){if(i&&v){return true;}return false;}.bind(this)},status:{path:"/userStatus",formatter:function(i){return sap.ushell.ui.launchpad.UserStatusItem.prototype.STATUS_ENUM[i];}.bind(this)},tooltip:t.getText("userStatus_tooltip"),image:sap.ui.core.IconPool.getIconURI("account"),press:function(i){var v=sap.ui.getCore().byId(i.mParameters.id);if(p.isOpen()){p.close();}else{p.openBy(v);}}.bind(this),contentList:p}).addStyleClass('sapUserStatusOpener');j.addCustomData(new A({key:"tabindex",value:"0",writeToDom:true}));j.addCustomData(new A({key:"aria-label",value:sap.ushell.resources.i18n.getText("OnlineStatus")+" "+t.getText("userStatus_tooltip"),writeToDom:true}));j.addCustomData(new A({key:"role",value:"listbox",writeToDom:true}));e.push(j);if(!C.disableSignOut){var l;if(!d){l=new B("logoutBtn",{visible:{parts:["/userStatusEnabled","/userStatusUserEnabled"],formatter:function(i,v){if(i&&v){return false;}return true;}.bind(this)},type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});e.push(l);}else{l=new sap.ushell.ui.launchpad.ActionItem("logoutBtn",{visible:true,type:sap.m.ButtonType.Transparent,icon:'sap-icon://log',text:sap.ushell.resources.i18n.getText("signoutBtn_title"),press:[c.logout,c]});}}var k=new V({items:[e]}).addStyleClass("sapUshellUserArea");var m=sap.ushell.Container.getUser(),n=m.getImage();if(!n){this.userBoxItem=new sap.ui.core.Icon({src:sap.ui.core.IconPool.getIconURI("person-placeholder"),size:'4rem'});}else{this.userBoxItem=this.createNewImage(n);}this.userBoxItem.addStyleClass("sapUshellMeAreaUserImage");var q=new H({items:[this.userBoxItem,k]});m.attachOnSetImage(this._updateUserImage.bind({origScope:this,oUserHBox:q,userBoxItem:this.userBoxItem}));q.addStyleClass('sapUshellMeAreaUserInfo');q.addStyleClass('sapContrastPlus');var w=c.createSaveButton(),x=c.createCancelButton();this.oSettingsDialog=new D({id:"userSettingsDialog",showHeader:false,content:null,buttons:[w,x],afterClose:function(){sap.ushell.Container.getUser().resetChangedProperties();},stretch:sap.ui.Device.system.phone}).addStyleClass("sapUshellUserSetting");this.oSettingsDialog.addContent(c.getSettingsDialogContent());this.aDanglingControls.push(x,w,this.oSettingsDialog);q.addEventDelegate({onsapskipback:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);},onsaptabprevious:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}});var y=new O({id:"overflowActions",design:sap.m.ToolbarDesign.Transparent,content:{path:"/currentState/actions",factory:function(i,v){var G=sap.ui.getCore().byId(v.getObject());if(G){if(G.setActionType){G.setActionType("action");}c._addPressHandlerToActions(G);}return G;}}}).addStyleClass('sapContrastPlus');y._getOverflowButtonSize=function(){return 82.4;};if(y._getOverflowButton){var z=y._getOverflowButton();if(z){var E=z.onAfterRendering;z.onAfterRendering=function(){if(E){E.apply(this,arguments);}this.addStyleClass('sapUshellActionItem');this.setText(sap.ushell.resources.i18n.getText('meAreaMoreActions'));};}}y.updateAggregation=function(N){var G=this.mBindingInfos[N],J=this.getMetadata().getJSONKeys()[N],K;jQuery.each(this[J._sGetter](),jQuery.proxy(function(i,v){this[J._sRemoveMutator](v);},this));jQuery.each(G.binding.getContexts(),jQuery.proxy(function(i,v){K=G.factory(this.getId()+"-"+i,v)?G.factory(this.getId()+"-"+i,v).setBindingContext(v,G.model):"";this[J._sMutator](K);},this));};var M=new V("sapUshellMeAreaContent",{});if(C.enableRecentActivity){this.actionBox=y;M.addItem(q);M.addItem(y);var F=this.createIconTabBar(c);F.done(function(i){M.addItem(i);});}else{y.addEventDelegate({onsaptabnext:function(i){var v=i.originalEvent,G=v.srcElement,J=jQuery('.sapUshellActionItem:last')[0].id,K;K=J===G.id;if(K===true){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}},onsapskipforward:function(i){i.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(i);}});M.addItem(q);M.addItem(y);}return new S({vertical:true,horizontal:false,height:"100%",content:M});},createIconTabBar:function(c){var R=new jQuery.Deferred(),t=this,i,o,d,m,e,s,C;sap.ui.require(['sap/m/IconTabBar','sap/m/StandardListItem','sap/m/IconTabFilter'],function(f,g,h){i=new f('meAreaIconTabBar',{backgroundDesign:sap.m.BackgroundDesign.Transparent,expandable:false,items:[t.createIconTab("recentActivities",true,c,g,h),t.createIconTab("frequentActivities",false,c,g,h)]}).addStyleClass('sapUshellMeAreaTabBar');i.addEventDelegate({onsaptabnext:function(E){var o=E.originalEvent,s=o.srcElement,C=s.classList,j;j=jQuery.inArray('sapUshellMeAreaActivityItem',C)>-1;if(j===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}},onsapskipforward:function(E){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}});d=i.onAfterRendering;i.onAfterRendering=function(){if(d){d.apply(t,arguments);}e=sap.ui.getCore().byId('meAreaIconTabBar--header');if(e){e.addStyleClass('sapContrastPlus');e.addStyleClass('sapUshellTabBarHeader');}};R.resolve(i);});return R.promise();},createIconTab:function(i,s,c,d,e){var o,f,t,g,l,h,j,k,m,p,v;o=function(n,C){f=C.getProperty("icon");t=C.getProperty("title");g=a.getDisplayName(C.getProperty("appType"));l={title:t,description:g,icon:f,type:sap.m.ListType.Active};if(s){l.info=C.getProperty("timestamp");}h=new d(l).addStyleClass('sapUshellMeAreaActivityItem');h.addCustomData(new A({key:"aria-describedby",value:j.getId(),writeToDom:true}));if(!f){h.addStyleClass('sapUshellMeAreaActivityItemNoIcon');}return h;};j=new e({id:"sapUshellIconTabBar"+i,text:r.i18n.getText(i)});k=new L({id:"sapUshellActivityList"+i,showSeparators:b.All,items:{path:"meAreaModel>/apps/"+i,factory:o.bind(this)},noDataText:sap.ushell.resources.i18n.getText(i+'NoDataText'),itemPress:function(E){m=this.getModel('meAreaModel');v=sap.ui.getCore().byId("viewPortContainer");if(v){v.switchState("Center");}p=E.getParameter('listItem').getBindingContextPath();c.setLastVisited(m.getProperty(p).url);setTimeout(function(){hasher.setHash(m.getProperty(p).url);},200);}});j.addContent(k);return j;},onViewStateShow:function(){this.getController().refreshRecentActivities();this.getController().refreshFrequentActivities();if(this.actionBox){this.actionBox.updateAggregation("content");}this.getController().updateScrollBar(hasher.getHash());},createNewImage:function(u){return new I({src:u});},getControllerName:function(){return"sap.ushell.renderers.fiori2.meArea.MeArea";},_updateUserImage:function(d){var u=(typeof d)==='string'?d:d.mParameters;this.oUserHBox.removeItem(this.userBoxItem);if(sap.ui.core.IconPool.isIconURI(u)){this.userBoxItem=new sap.ui.core.Icon({src:sap.ui.core.IconPool.getIconURI(u),size:'4rem'});}else{this.userBoxItem=this.origScope.createNewImage(u);}if(this.userBoxItem){this.userBoxItem.addStyleClass("sapUshellMeAreaUserImage");this.oUserHBox.insertItem(this.userBoxItem,0);}}});},false);
